#include <iostream>
#include "Image_Class.h"

using namespace std;

Image rotated_image(Image img ,Image final_img, string filename , string file_last_name)
{
    cout << "Please choose what degree adjustment do you want?" <<"\n"<< "90 degree - 180 degree - 270 degree" << endl;
    int x;
    while (true) {
        cin >> x;

        if (x == 90 || x == 180 || x == 270) {
            if (x == 90)
            {
                final_img = Image(img.height, img.width); 
                for (int i = 0; i < img.width; i++)
                {
                    for (int j = 0; j < img.height; j++) 
                    {
                        int temp1 = img.height - 1 - j;
                        int temp2 = i;
                        for (int k = 0; k < 3; k++)
                        {
                            final_img(temp1, temp2, k) = img(i, j, k);
                        }
                    }
                }
                final_img.saveImage(file_last_name);
                return final_img;
            }
            else if (x == 180) 
            {
                final_img = Image(img.width, img.height); 
                for (int i = 0; i < img.width; i++)
                {
                    for (int j = 0; j < img.height; j++) 
                    {
                        int temp1 = img.width - 1 - i;
                        int temp2 = img.height - 1 - j;
                        for (int k = 0; k < 3; k++)
                        {
                            final_img(temp1, temp2, k) = img(i, j, k);
                        }
                    }
                }
                final_img.saveImage(file_last_name);
                return final_img;
            }
            else if (x == 270)
            {
                final_img = Image(img.height, img.width); 
                for (int i = 0; i < img.width; i++)
                {
                    for (int j = 0; j < img.height; j++) 
                    {
                        int temp1 = j;
                        int temp2 = img.width - 1 - i;
                        for (int k = 0; k < 3; k++)
                        {
                            final_img(temp1, temp2, k) = img(i, j, k);
                        }
                    }
                }
                final_img.saveImage(file_last_name);
                return final_img;
            }
        }
        else {
            cout << "Invalid input. Please enter 90, 180, or 270:" << endl;
        }
    }
}
int main()
{
    string filename , file_last_name;
    while (true) {
        cout << "plz enter the file name with format " <<endl;
        cin >> filename;
        try {
            Image img(filename); 
            cout <<"plz enter the new name with the new format " << endl;
            cin >> file_last_name; 
            
            Image final_img; 
            rotated_image(img, final_img, filename, file_last_name);
        } catch (std::invalid_argument const& e ) {
            std::cout << "Error: " << e.what() << ". Please try again." <<endl;
        } 
    }
    
    return 0;
}
